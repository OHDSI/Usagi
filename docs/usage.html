<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Usagi - Usage</title>

<script src="site_libs/header-attrs-2.5/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="site_libs/anchor-sections-1.0/anchor-sections.js"></script>
<link rel='shortcut icon' type='image/x-icon' href='images/favicon.ico' />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"><div><img src="images/ohdsi16x16.png"></img> OHDSI Usagi</div></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="glyphicon glyphicon-home"></span>
     
  </a>
</li>
<li>
  <a href="installation.html">
    <span class="glyphicon glyphicon-save"></span>
     
    Installation &amp; Setup
  </a>
</li>
<li>
  <a href="usage.html">
    <span class="glyphicon glyphicon-list"></span>
     
    Using the Application Functions
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="readme.html">
    <span class="glyphicon glyphicon-book"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/ohdsi/usagi">
    <span class="glyphicon glyphicon-link"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Using the Application Functions</h1>

</div>


<div id="importing-source-codes-into-usagi" class="section level1">
<h1>Importing Source Codes into Usagi</h1>
<p>Export source codes from source system into a CSV or Excel (.xlsx) file. This should at least have columns containing the <strong>source code</strong> and an English <strong>source code description</strong>, however additional information about codes can be brought over as well (e.g. dose unit, or the description in the original language if translated). In addition to information about the source codes, the <strong>frequency of the code</strong> should preferably also be brought over, since this can help prioritize which codes should receive the most effort in mapping (e.g. you can have 1,000 source codes but only 100 are truly used within the system). If any source code information needs translating to English, use Google Translate to do that.</p>
<p>Note: source code extracts should be broken out by domain (i.e. drugs, procedures, conditions, observations) and not lumped into one large file.</p>
<p>Source codes are loaded into Usagi from the <em>File –&gt; Import codes</em> menu. From here an “Import codes …” will display as seen in Figure 1.</p>
<p><img src="images/usagiimport.png" /> <strong>Figure 1: Usagi Source Code Input Screen</strong></p>
<p>In Figure 1, the source code terms were in Dutch and were also translated into English. Usagi will leverage the English translations to map to the standard vocabulary.</p>
<p><img src="images/usagiimport2.png" /> <strong>Figure 2: Telling Usagi how to Read Input File</strong></p>
<p>Seen in Figure 2, the <em>Column mapping</em> section is where you define for Usagi how to use the imported CSV. If you mouse hover over the drop downs, a pop-up will appear defining each column. Usagi will not use the <em>Additional info column(s)</em> as information to associate source codes to Vocabulary concept codes; however this additional information may help the individual reviewing the source code mapping and should be included.</p>
<p>Finally you can set some restrictions for Usagi when mapping. For example, in Figure 3, the user is mapping the source codes only to concepts in the Condition domain. By default, Usagi only maps to Standard Concepts, but if the the option ‘Filter standard concepts’ is turned off, Usagi will also consider Classification Concepts. Hover your mouse over the different filters for additional information about the filter.</p>
<p>One special filter is <em>Filter by automatically selected concepts / ATC code</em>. If there is information that you can use to restrict the search, you can do so by providing a list of CONCEPT_IDs or an ATC code in the column indicated in the <em>Auto concept ID column</em> (semicolon-delimited). For example, in the case of drugs there might already be ATC codes assigned to each drug. Even though an ATC code does not uniquely identify a single RxNorm drug code, it does help limit the search space to only those concepts that fall under the ATC code in the Vocabulary. To use the ATC code, follow these steps:</p>
<ol style="list-style-type: decimal">
<li>In the Column mapping section, switch from ‘Auto concept ID column’ to ‘ATC column’</li>
<li>In the Column mapping section, select the column containing the ATC code as ‘ATC column’.</li>
<li>Turn on the ‘Filter by user selected concepts / ATC code’ on in the Filters section.</li>
</ol>
<p>You can also use other sources of information than the ATC code to restrict as well. In the example shown in the figure above, we used a partial mapping derived from UMLS to restrict the Usagi searh. In that case we will need to use ‘Auto concept ID column’.</p>
<p><img src="images/usagiimport3.png" /> <strong>Figure 3: Defining filter rules when mapping</strong></p>
<p>Once all your settings are finalized, click the “Import” button to import the file. The file import will take a few minutes as it is running the term similarity algorithm to map source codes. # Reviewing Source Code to OMOP Vocabulary Concept Maps</p>
<p>Once you have imported your input file of source codes, the mapping process begins.</p>
<p><img src="images/usagiscreen1.png" /> <strong>Figure 4: Usagi Matching Screen</strong></p>
<p>In Figure 4, you see the Usagi screen is made up of 3 main sections: an overview table, the selected mapping section, and place to perform searches.</p>
<p>Note that in any of the tables, you can right-click to select the columns that are shown or hidden to reduce the visual complexity.</p>
</div>
<div id="approving-a-suggested-mapping" class="section level1">
<h1>Approving a Suggested Mapping</h1>
<p>The Overview Table shows the current mapping of source codes to concepts. Right after importing source codes, this mapping contains the automatically generated suggested mappings based on term similarity and any search options. In the example in Figure 4, the English names of Dutch condition codes were mapped to standard concepts in the Condition domain, because the user restricted the search to that domain. Usagi compared the source code descriptions to concept names and synonyms to find the best match. Because the user had selected ‘Include source terms’ Usagi also considered the names and synonyms of all source concepts in the vocabulary that map to a particular concept.If Usagi is unable to make a mapping, it will map to the CONCEPT_ID = 0.</p>
<p><img src="images/usagiscreen2.png" /> <strong>Figure 5: Reviewing an Usagi Match</strong></p>
<p>It is suggested that someone with experience with coding systems help map source codes to their associated standard vocabulary. That individual will work through code by code in the Overview Table to either accept the mapping Usagi has suggested or choose a new mapping. For example in Figure 5 we see that the Dutch term “Hoesten” which was translated to the English term “Cough”. Usagi used “Cough” and mapped it to the OMOP Vocabulary concept of “4158493-C/O - cough”. There was a matching score of 0.58 associated to this matched pair (matching scores are typically 0 to 1 with 1 being a confident match), a score of 0.58 signifies that Usagi is not very sure of how well it has mapped this Dutch code to SNOMED. Let us say in this case, we are okay with this mapping, we can approve it by hitting the green “Approve” button in the bottom right-hand portion of the screen.</p>
<div id="equivalence" class="section level2">
<h2>Equivalence</h2>
<p>In Usagi 1.4+, we can assign an equivalence status when approving. This allows the reviewer to capture how well the target concept(s) capture the meaning of the source term.</p>
<p><img src="images/equivalences.png" /></p>
<p>The equivalence definitions are based on the <a href="https://www.hl7.org/fhir/codesystem-concept-map-equivalence.html">the HL7 concept map equivalence</a>:</p>
<ul>
<li><strong>Equal</strong> = The concepts are exactly the same (i.e. intentionally identical).</li>
<li><strong>Equivalent</strong> = The concepts mean the same thing (i.e. extensionally identical).</li>
<li><strong>Wider</strong> = The target contains more information than to the source.</li>
<li><strong>Narrower</strong> = The target contains less information than the source.</li>
<li><strong>Inexact</strong> = The target overlaps with the source, but both source and target cover additional meaning.</li>
<li><strong>Unmatched</strong> = There is no match for this concept in the target code system.</li>
</ul>
</div>
</div>
<div id="searching-for-a-new-mapping" class="section level1">
<h1>Searching for a New Mapping</h1>
<p><img src="images/usagiscreen3.png" /> <strong>Figure 6: Searching for a New Concept</strong></p>
<p>There will be cases where Usagi suggests a map and the user will be left to either try to find a better mapping or set the map to no concept (CONCEPT_ID = 0). In the example given in Figure 6, we see for the Dutch Term “Hoesten”, which was translated to “Cough”. Usagi’s suggestion was restricted by the concept identified in our automatically derived mapping from UMLS, and the result might not be optimal. In the Search Facility, we could search for other concepts using either the actual term itself or a search box query.</p>
<p>When using the manual search box, one should keep in mind that Usagi uses a fuzzy search, and does not support structured search queries, so for example not supporting boolean operators like AND and OR.</p>
<p>To continue our example, suppose we used the search term “Cough” to see if we could find a better mapping. On the right of the <em>Query</em> section of the Search Facility, there is a <em>Filters</em> section, this provides options to trim down the results from the OMOP Vocabulary when searching for the search term. In this case we know we want to only find standard concepts, and we allow concepts to be found based on the names and synonyms of source concepts in the vocabulary that map to those standard concepts.</p>
<p>When we apply these search criteria we find “254761-Cough” and feel this may be an appropriate Vocabulary concept to map to our Dutch code, in order to do that we can hit the “Replace concept”, which you will see the Selected Source Code section update, followed by the “Approved” button. There is also an “Add concept” button, this allows for multiple standardized Vocabulary concepts to map to one source code (e.g. some source codes may bundle multiple diseases together while the standardized vocabulary may not).</p>
</div>
<div id="concept-information" class="section level1">
<h1>Concept information</h1>
<p>When looking for appropriate concepts to map to, it is important to consider the ‘social life’ of a concept. The meaning of a concept might depend partially on its place in the hierarchy, and sometimes there are ‘orphan concepts’ in the vocabulary with few or no hierarchical relationships, which would be ill-suited as target concepts. Usagi will often report the number of parents and children a concept has, and it also possible to show more information by pressing <em>ALT + C</em>, or selecting <em>VIEW</em> –&gt; <em>Concept information</em> in the top menu bar.</p>
<p><img src="images/conceptinformation.png" /> <strong>Figure 7: Concept information panel</strong></p>
<p>It shows general information about a concept, as well as its parents, children, synonyms and other source codes that map to the concept. Users can use this panel to navigate the hierarchy and potentially choose a different target concept.</p>
<p>In addition, Usagi allows to directly open <a href="https://athena.ohdsi.org/">Athena</a> in your default browser for the selected concept. When a concept is selected, press <em>ALT + W</em> or click on <em>View-&gt; Athena (web)</em>. Similarly, we can search google for a source code description with <em>ALT + G</em> or <em>View –&gt; Google (web)</em>.</p>
</div>
<div id="auto-mapped" class="section level1">
<h1>Auto Mapped</h1>
<p>When you import your source codes there is an option to add information about “Auto concept ID column”. If there is information already known that will allow you to map your source data to a CONCEPT_ID, you can include that in the file you upload into Usagi. Once loaded, the Overview Table will list these codes with a status of “Auto mapped to 1” if only one CONCEPT_ID was provided, or just “Auto mapped” if there were more. You still will be required to approve these auto mappings using the “Approve” button, or if you really trust the underlying information, you can sort by status, select all codes with status ‘Auto mapped to 1”, and click <em>Edit –&gt; Approve selected</em>.</p>
<p>Continue to move through this process, code by code, until all codes have been checked. In the list of source codes at the top of the screen, by selecting the column heading you can sort the codes. Often we suggest going from the highest frequency codes to the lowest. In the bottom left of the screen you can see the number of codes that have approved mappings, and how many code occurrences that corresponds to.</p>
<p>It is possible to add comments to mappings, which could be used to document why a particular mapping decision was made.</p>
<p>Best Practices:</p>
<ul>
<li>Use someone who has experience with coding schemes.</li>
<li>By clicking on a column name you can sort the columns in the Overview Table. It may be valuable to sort on “Match Score”; reviewing codes that Usagi is most confident on first may quickly knock out a significant chunk of codes. Also sorting on “Frequency” is valuable, spending more effort on frequent codes versus non-frequent is important.</li>
<li>It is okay to map some codes to CONCEPT_ID = 0, some codes may not be worth it to find a good map and others may just lack a proper map.</li>
<li>It is important to consider the context of a concept, specifically its parents and children.</li>
</ul>
</div>
<div id="export-the-usagi-map-created" class="section level1">
<h1>Export the Usagi Map Created</h1>
<p>Once you have created your map within USAGI, the best way to use it moving forward is to export it and append it to the OMOP Vocabulary SOURCE_TO_CONCEPT_MAP table.</p>
<p>To export your mappings go to <em>File –&gt; Export source_to_concept_map</em>. A pop-up will appear asking you which SOURCE_VOCABULARY_ID you would like to use, type in a number (it is suggested to make the ID greater than 100 so that it can be easily identified as a non-OMOP vocabulary). Usagi will use this number as the SOURCE_VOCABULARY_ID which will allow you to identify your specific mapping in the SOURCE_TO_CONCEPT_MAP table. For example, if you SOURCE_VOCABULARY_ID = 200 then when mapping to TARGET_CONCEPT_IDs you can filter the SOURCE_TO_CONCEPT_MAP table where SOURCE_VOCABULARY_ID = 200.</p>
<p>After selecting the SOURCE_VOCABULARY_ID, you give your export CSV a name and save to location. The export CSV structure is in that of the SOURCE_TO_CONCEPT_MAP table. This mapping could be appended to the OMOP Vocabulary’s SOURCE_TO_CONCEPT_MAP table. It would also make sense to append a single row to the VOCABULARY table defining the SOURCE_VOCABULARY_ID you defined in the step above. Finally, it is important to note that only mappings with the “Approved” status will be exported into the CSV file; the mapping needs to be completed in USAGI in order to export it.</p>
</div>
<div id="updating-an-usagi-mapping" class="section level1">
<h1>Updating an Usagi mapping</h1>
<p>Often a mapping is not a one-time effort. As data is updated perhaps new source codes are added, and also the vocabulary is updated regularly, perhaps requiring an update of the mapping.</p>
<p>When the set of source codes is updated the following steps can be followed to support the update:</p>
<ol style="list-style-type: decimal">
<li>Import the new source code file</li>
<li>Choose <em>File</em> –&gt; <em>Apply previous mapping</em>, and select the old Usagi mapping file. Note that the format of the previous mapping should be as created by <em>Save</em> or <em>Save As</em>. Other formats do not work.</li>
<li>Identify codes that haven’t inherited approved mappings from the old mapping, and map them as usual.</li>
</ol>
<p>Note: the additional info columns of the applied mapping are ignored. These are <strong>not merged</strong> with the additional information in the already opened mapping.</p>
<p>When the vocabulary is updated, follow these steps:</p>
<ol style="list-style-type: decimal">
<li>Download the new vocabulary files from Athena</li>
<li>Rebuild the Usagi index (<em>Help</em> –&gt; <em>Rebuild index</em>)</li>
<li>Open the mapping file</li>
<li>Identify codes that map to concepts that in the new vocabulary version no longer are Standard concepts, and find more appropriate target concepts.</li>
</ol>
</div>
<div id="menu-options" class="section level1">
<h1>Menu Options</h1>
<p><embed src="https://www.ohdsi.org/web/wiki/lib/exe/fetch.php?media=documentation:usagiscreen4.png" /></p>
<p>Once you have loaded a source code file to begin mapping using Usagi you can save this working file using <em>File –&gt; Save or File –&gt; Save as</em>. Once you save the file you can close Usagi at any time and come back to your file later by using <em>File –&gt; Open</em>.</p>
<p>The Edit menu provides options around approving. <em>Approved selected</em> is helpful if you want to approve many codes at one time.</p>
<p>The <em>View –&gt; Concept information</em> is designed to help a user get more information about a concept they are reviewing however this feature is currently still experimental.</p>
<p>The <em>Help</em> menu will get you to <em>About Usagi</em> will point you to informative links or <em>Rebuild Index</em> which provides you the option to rebuild the index off the OMOP Vocabulary. Typically you will rebuild an index if your current index has a flaw or you have received an updated version of the OMOP Vocabulary.</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
